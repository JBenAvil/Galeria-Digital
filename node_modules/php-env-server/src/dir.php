<?php
// VARIABLES
$REQUEST_URI = $_SERVER["REQUEST_URI"];
$FULL_PATH = $_SERVER["DOCUMENT_ROOT"] . $REQUEST_URI;
$title = "Index of $REQUEST_URI";
?>

<!DOCTYPE html>
<html>

<head>
    <title><?= $title ?></title>
    <base href="<?= str_replace("//", "/", $_SERVER["REQUEST_URI"] . "/") ?>">
    <style>
        td {
            margin: 0;
            padding: 0;
        }

        .text-center {
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- TITLE -->
    <h1><?= $title ?></h1>

    <!-- TABLE -->
    <table>
        <tr>
            <td>&nbsp;</td>
            <td class="text-center">Name</td>
            <td class="text-center">Last modified</td>
            <td class="text-center">Size</td>
            <td class="text-center">Description</td>
        </tr>
        <tr>
            <th colspan="5">
                <hr>
            </th>
        </tr>
        <tr>
            <td><img src="/icons/back.gif" alt="[PARENTDIR]"></td>
            <td><a href="<?= dirname($REQUEST_URI) ?>">Parent Directory</a></td>
            <td>&nbsp;</td>
            <td> - </td>
            <td>&nbsp;</td>
        </tr>

        <?php
        // EACH file
        foreach (array_slice(scandir(realpath($FULL_PATH)), 2) as $file) {
            // VARIABLES
            $realpath = realpath("$FULL_PATH/$file");
            $is_dir = is_dir($realpath);
        ?>

            <tr>
                <td><img src="<?= ($is_dir) ? "/icons/folder.gif" : "/icons/unknown.gif" ?>" alt="<?= ($is_dir) ? "[DIR]" : "[FILE]" ?>"></td>
                <td><a href="<?= "$file" ?>"><?= $file ?></a></td>
                <td><?= date("Y-m-d H:i:s", filemtime($realpath)) ?></td>
                <td><?= ($is_dir) ? "" : (round(filesize($realpath) / 1024, 2)) . " KB" ?></td>
                <td>&nbsp;</td>
            </tr>

        <?php
        };
        ?>

        <tr>
            <th colspan="5">
                <hr>
            </th>
        </tr>
    </table>

    <!-- ADDRESS -->
    <address><b>PHP - Server at <?= $_SERVER["SERVER_NAME"] ?> Port <?= $_SERVER["SERVER_PORT"] ?></b></address>
</body>

</html>